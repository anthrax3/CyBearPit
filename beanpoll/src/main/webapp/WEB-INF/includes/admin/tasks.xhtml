<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
             xmlns:b="http://bootsfaces.net/ui"
             xmlns:f="http://xmlns.jcp.org/jsf/core"
             xmlns:h="http://xmlns.jcp.org/jsf/html"
             xmlns:ui="http://java.sun.com/jsf/facelets">

    <!--Option to create a new task-->
    <b:panel title="Create a New Task" look="info" collapsed="#{true}">
        <h:form>
            <b:panelGrid colSpans="2,6,4" size="xs">
                <h:outputLabel value="Contest:" for="ncontest"/>
                <b:selectOneMenu value="#{newTask.contest}" id="ncontest">
                    <f:facet name="prepend"><b:iconAwesome name="trophy"/></f:facet>
                    <f:selectItems value="#{contests}" var="_contest"
                                   itemLabel="#{_contest.name}" itemValue="#{_contest}"/>
                </b:selectOneMenu>
                <h:outputText value=""/>
                <h:outputLabel value="Name:" for="nname"/>
                <b:inputText value="#{newTask.name}" id="nname" class="form-control">
                    <f:facet name="prepend"><b:iconAwesome name="check"/></f:facet>
                </b:inputText>
                <h:outputText value=""/>
                <h:outputLabel value="Description:" for="ndescription"/>
                <b:inputTextarea value="#{newTask.description}" id="ndescription"/>
                <b:commandButton action="#{taskController.create()}" value="Create" look="success"/>
            </b:panelGrid>
        </h:form>
    </b:panel>

    <!--Show the unassigned tasks first-->
    <ui:repeat var="_utask" value="#{unassignedTasks}">
        <b:panel title="Unassigned: #{_utask.name}" look="warning" collapsed="#{true}">

            <!-- Basic task settings -->
            <b:panel title="Settings" collapsed="#{true}">
                <h:form>
                    <b:panelGrid colSpans="2,6,4" size="xs">
                        <h:outputLabel value="Contest:" for="contest"/>
                        <b:selectOneMenu value="#{_utask.contest}" id="contest">
                            <f:facet name="prepend"><b:iconAwesome name="trophy"/></f:facet>
                            <f:selectItems value="#{contests}" var="_contest"
                                           itemLabel="#{_contest.name}"
                                           itemValue="#{_contest}"/>
                        </b:selectOneMenu>
                        <h:outputText value=""/>
                        <h:outputLabel value="Name:" for="nname"/>
                        <b:inputText value="#{_utask.name}" id="nname" class="form-control">
                            <f:facet name="prepend"><b:iconAwesome name="check"/></f:facet>
                        </b:inputText>
                        <h:outputText value=""/>
                        <h:outputLabel value="Description:" for="ndescription"/>
                        <b:inputTextarea value="#{_utask.description}" id="ndescription"/>
                        <h:outputText value=""/>
                    </b:panelGrid>
                    <b:panelGrid colSpans="2,2,8" size="sm">
                        <h:outputText value=""/>
                        <b:commandButton action="#{taskController.update(_utask)}"
                                         value="Update" look="info"/>
                        <b:commandButton action="#{taskController.delete(_utask)}"
                                         value="Delete" look="danger"/>
                    </b:panelGrid>
                </h:form>
            </b:panel>

            <!-- Task responses -->
            <b:panel title="Responses" collapsed="#{true}">
                <b:dataTable var="_response" value="#{_utask.responses}">
                    <b:dataTableColumn value="#{_response.team}">
                        #{_response.team.name}
                    </b:dataTableColumn>
                    <b:dataTableColumn value="#{_response.contents}"/>
                    <b:dataTableColumn value="#{_response.points}"/>
                </b:dataTable>
            </b:panel>
        </b:panel>
    </ui:repeat>

    <!--The remaining tasks are grouped by contest-->
    <ui:repeat value="#{contests}" var="_contest">
        <ui:repeat var="_task" value="#{_contest.tasks}">
            <b:panel title="#{_contest.name}: #{_task.name}" look="#{_contest.look}"
                     collapsed="#{true}">

                <!-- Basic task settings -->
                <b:panel title="Settings" collapsed="#{true}">
                    <h:form>
                        <b:panelGrid colSpans="2,6,4" size="xs">
                            <h:outputLabel value="Contest:" for="contest"/>
                            <b:selectOneMenu value="#{_task.contest}" id="contest">
                                <f:facet name="prepend"><b:iconAwesome name="trophy"/></f:facet>
                                <f:selectItems value="#{contests}" var="_contest"
                                               itemLabel="#{_contest.name}"
                                               itemValue="#{_contest}"/>
                            </b:selectOneMenu>
                            <h:outputText value=""/>
                            <h:outputLabel value="Name:" for="nname"/>
                            <b:inputText value="#{_task.name}" id="nname" class="form-control">
                                <f:facet name="prepend"><b:iconAwesome name="check"/></f:facet>
                            </b:inputText>
                            <h:outputText value=""/>
                            <h:outputLabel value="Description:" for="ndescription"/>
                            <b:inputTextarea value="#{_task.description}" id="ndescription"/>
                            <h:outputText value=""/>
                        </b:panelGrid>
                        <b:panelGrid colSpans="2,2,8" size="sm">
                            <h:outputText value=""/>
                            <b:commandButton action="#{taskController.update(_task)}"
                                             value="Update" look="info"/>
                            <b:commandButton action="#{taskController.delete(_task)}"
                                             value="Delete" look="danger"/>
                        </b:panelGrid>
                    </h:form>
                </b:panel>

                <!-- Task responses -->
                <b:panel title="Responses" collapsed="#{true}">
                    <b:dataTable var="_response" value="#{_task.responses}">
                        <b:dataTableColumn value="#{_response.team}">
                            #{_response.team.name}
                        </b:dataTableColumn>
                        <b:dataTableColumn value="#{_response.contents}"/>
                        <b:dataTableColumn value="#{_response.points}"/>
                    </b:dataTable>
                </b:panel>
            </b:panel>
        </ui:repeat>
    </ui:repeat>
</ui:fragment>